<div style="width: 100%">
  <div
    class="bg-dark pt-3 px-3 pt-md-5 px-md-5 text-center text-white overflow-hidden"
    style="width: 60%; border-radius: 21px; margin: auto"
  >
    <div class="my-3 py-3">
      <h2 class="display-5" style="margin-bottom: 40px">
        Rozpoczęte aplikacje
      </h2>
      <div style="max-height: calc(100vh - 400px); overflow-y: auto">
        <table>
          <tr>
            <th>Nazwa</th>
            <th>GainedID</th>
            <th>Status</th>
            <th>Odebrano</th>
          </tr>
          <tr *ngFor="let cert of certificates">
            <td
              (click)="
                getUnconfirmed(cert.id, cert.certificateID, stepManagement)
              "
            >
              {{ cert.certificateName }}
            </td>
            <td>{{ cert.id }}</td>
            <td>
              <p
                *ngIf="cert.collected"
                style="color: green"
                (click)="openFinished(cert.id, certificateConfirm)"
              >
                Uzyskano.
              </p>
              <p
                *ngIf="!cert.collected"
                style="color: orange"
                (click)="
                  getUnconfirmed(cert.id, cert.certificateID, stepManagement)
                "
              >
                W trakcie.
              </p>
            </td>
            <td
              (click)="
                getUnconfirmed(cert.id, cert.certificateID, stepManagement)
              "
            >
              <p
                *ngIf="cert.gained"
                style="color: green"
                (click)="openFinished(cert.id, certificateConfirm)"
              >
                Odebrano.
              </p>
              <p
                *ngIf="!cert.gained"
                style="color: orange"
                (click)="
                  getUnconfirmed(cert.id, cert.certificateID, stepManagement)
                "
              >
                Nie odebrano.
              </p>
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div class="bg-light shadow-sm mx-auto"></div>
  </div>
</div>

<ng-template #stepManagement style="width: 900px; box-sizing: content-box">
  <div class="modal-header text-center">
    <div class="text-center w-100">
      <p>{{ step.id }}</p>
      <p style="font-weight: bold">{{ step.certificateStepId }}</p>
    </div>
  </div>
  <div class="modal-body">
    <p>Rozpoczęto {{ step.startDate | date: "mediumDate" }}</p>
    <p>Etap: {{ step.stepName }}</p>
    <p>{{ step.stepDescription }}</p>
    <p>Komentarz: {{ step.comment }}</p>
    <div class="input-group mb-3 w-100">
      <input
        #fileInput
        type="file"
        placeholder="Dołącz plik..."
        (change)="onFileSelect($event)"
      />
      <button
        class="input-group-text btn btn-success"
        id="searchCertificates"
        (click)="addFile(step.id)"
        [disabled]="!file"
      >
        Załącz
      </button>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary w-100" (click)="openDetails(template)">
      Szczegóły
    </button>
  </div>
</ng-template>

<ng-template #template>
  <div class="modal-header text-center">
    <div class="text-center w-100">
      <p>Certyfikat numer</p>
      <p style="font-weight: bold">{{ selectedCertificate.id }}</p>
    </div>
  </div>
  <div class="modal-body">
    <p>Liczba kroków: {{ selectedCertificate.certificateSteps.length }}</p>
    <div
      *ngFor="let step of selectedCertificate.certificateSteps; let i = index"
    >
      <div style="display: inline-block; width: 100%">
        <p style="float: left">
          {{ i + 1 }}. {{ step.name }} ({{ step.description }})
        </p>
        <button
          class="btn btn-success"
          style="margin: auto; float: right"
          id="getAttachment"
          [disabled]="!step.fileId"
          (click)="downloadFile(step.fileId)"
        >
          Pobierz załącznik
        </button>
      </div>
    </div>
    <button
      class="btn btn-primary w-100"
      style="margin-top: 10px"
      (click)="modalRef.hide()"
    >
      Zamknij
    </button>
  </div> </ng-template
>-

<ng-template #certificateConfirm>
  <div class="modal-header text-center">
    <p style="font-weight: bold">Dodaj plik z certyfikatem dla użytkownika</p>
  </div>
  <div class="modal-body">
    <p>Zakończono {{ selectedGainedCertificate.gainDate | date: "medium" }}</p>
  </div>
</ng-template>
